<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Speech Translator</title>
    <link rel="stylesheet" href="./styles.css?v=1.0.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <!-- Logo -->
      <div class="logo-container">
        <img src="trilogy-logo.svg" alt="Trilogy Innovations" class="trilogy-logo">
      </div>
      <!-- Header -->
      <header class="header">
        <h1>üé§ Real-Time Speech Translator</h1>
        <p>Instant translation with live captions for online meetings</p>
      </header>

      <!-- Language Selection -->
      <div class="language-section">
        <div class="language-selector">
          <label for="sourceLanguage">From:</label>
          <select id="sourceLanguage">
            <option value="en-US">English (US)</option>
            <option value="es-ES">Spanish</option>
            <option value="fr-FR">French</option>
            <option value="de-DE">German</option>
            <option value="it-IT">Italian</option>
            <option value="pt-BR">Portuguese</option>
            <option value="ru-RU">Russian</option>
            <option value="ja-JP">Japanese</option>
            <option value="ko-KR">Korean</option>
            <option value="zh-CN">Chinese</option>
          </select>
        </div>
        <div class="language-selector">
          <label for="targetLanguage">To:</label>
          <select id="targetLanguage">
            <option value="es">Spanish</option>
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
            <option value="pt">Portuguese</option>
            <option value="ru">Russian</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
            <option value="zh">Chinese</option>
          </select>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="control-panel">
        <button id="startBtn" class="btn btn-primary">
          üé§ Start Listening
        </button>
        <button id="stopBtn" class="btn btn-secondary" disabled>
          ‚èπÔ∏è Stop Listening
        </button>
        <button id="clearBtn" class="btn btn-outline">
          üóëÔ∏è Clear Transcript
        </button>
        <button id="exportBtn" class="btn btn-outline">
          üì• Export Transcript
        </button>
        <button id="demoBtn" class="btn btn-outline">üé≠ Demo Mode</button>
        <button id="testWsBtn" class="btn btn-outline">
          üîå Test WebSocket
        </button>
        <button id="pipBtn" class="btn btn-outline">
          üì∫ Picture-in-Picture
        </button>
      </div>

      <!-- Status Indicator -->
      <div class="status-section">
        <div id="statusIndicator" class="status-indicator">
          <span class="status-dot"></span>
          <span id="statusText">Ready to start</span>
        </div>
        <div class="connection-info">
          <span id="connectionType">WebSocket</span>
          <span id="latency">Latency: -- ms</span>
        </div>
      </div>

      <!-- Live Captions -->
      <div class="captions-section">
        <h3>Live Captions</h3>
        <div class="captions-container">
          <div id="currentCaption" class="current-caption">
            <div class="caption-text">
              <span class="label">Original:</span>
              <span id="originalText" class="text"
                >Start speaking to see live captions...</span
              >
            </div>
            <div class="caption-text">
              <span class="label">Translation:</span>
              <span id="translatedText" class="text"
                >Start speaking to see live captions...</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Transcript History -->
      <div class="transcript-section">
        <h3>Transcript History</h3>
        <div class="transcript-container">
          <div id="transcriptList" class="transcript-list">
            <!-- Transcript items will be added here dynamically -->
          </div>
        </div>
      </div>

      <!-- Settings Panel -->
      <div class="settings-panel">
        <h3>Settings</h3>
        <div class="setting-item">
          <label for="punctuationToggle">Restore Punctuation:</label>
          <input type="checkbox" id="punctuationToggle" checked />
        </div>
        <div class="setting-item">
          <label for="silenceDetection">Detect Silences:</label>
          <input type="checkbox" id="silenceDetection" checked />
        </div>
        <div class="setting-item">
          <label for="speakerDiarization">Speaker Detection:</label>
          <input type="checkbox" id="speakerDiarization" checked />
        </div>
        <div class="setting-item">
          <label for="captionDelay">Caption Delay (ms):</label>
          <input
            type="number"
            id="captionDelay"
            value="100"
            min="0"
            max="1000"
          />
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
      <p>Made by Piyush Ghegade - IIT Patna</p>
    </footer>

    <!-- Caption Overlay (for screen sharing) -->
    <div id="captionOverlay" class="caption-overlay">
      <div class="overlay-content">
        <div id="overlayOriginal" class="overlay-text original">Waiting for speech...</div>
        <div id="overlayTranslated" class="overlay-text translated">Waiting for translation...</div>
      </div>
      <button id="closeOverlay" class="overlay-close">√ó</button>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
      // Fallback to alternative CDN if primary fails
      if (typeof io === "undefined") {
        const script = document.createElement("script");
        script.src =
          "https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js";
        script.onload = () => console.log("Socket.IO loaded from fallback CDN");
        script.onerror = () =>
          console.error("Socket.IO failed to load from both CDNs");
        document.head.appendChild(script);
      }

      // Debug: Check if Socket.IO is loaded
      console.log("Socket.IO loaded:", typeof io !== "undefined");
      if (typeof io !== "undefined") {
        console.log("Socket.IO version:", io.version);
      }
    </script>
    <script type="module" src="app.js?v=1.0.1"></script>
  </body>
</html>
